<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="apple-touch-icon-precomposed" sizes="128x128" href="favicon.ico">
    <link rel="shortcut icon" href="favicon.ico">
    <title>NEU-Mathe</title>
    <link rel="stylesheet" href="css/element-ui.css">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
<header id="header">
    <div class="wrap">
        <div id="logo">
            <div id="site-title">
                NEU-Mathe
            </div>
        </div>
        <div id="avatar">
            <img :src="avatarURL">
        </div>
    </div>
</header>
<div id="container">
    <div id="type">
        <el-radio-group v-model='radioType' size='large'>
            <el-radio-button v-for="type in types" size='large' :label="type.name" :key="type.id"></el-radio-button>
        </el-radio-group>
    </div>
    <div class="subject" v-for="sjt in subjects">
        <el-button type="primary" size="large"
                   @click="selectedSubject=sjt;loadChapter()">{{sjt.name}}
        </el-button>
    </div>
    <div id="dialog">
        <el-dialog :title="selectedSubject.name+' - '+radioType" v-model="dialogVisible" top="8%" size="large"
                   :close-on-click-modal="false" custom-class="wrap">
            <span>
                <el-alert v-if="networkError" title="网络错误" type="error" description="无法加载，请重试"
                          show-icon :closable="false">
                </el-alert>
                <el-tabs v-else v-model="dialogTab" type="card" v-loading="loadingChapter">
                    <el-tab-pane label="考点选择" name="selection">
                        <el-tree :data="topics" :props="defaultProps" node-key="id" ref="tree" show-checkbox accordion>
                        </el-tree>
                    </el-tab-pane>
                    <el-tab-pane label="高级设置" name="configure">
                        <el-form label-position="right" label-width="80px" :model="advancedSettings">
                            <el-form-item label="测试题数">
                                <el-slider v-model="advancedSettings.problemCount" :min="15" :max="40"
                                           show-input></el-slider>
                            </el-form-item>
                            <el-form-item label="测试时间">
                                <el-slider v-model="advancedSettings.examTime" :min="60" :max="120" :step="5" show-stops
                                           show-input></el-slider>
                            </el-form-item>
                            <el-form-item label="自显解析">
                                <el-switch on-text="" off-text="" v-model="advancedSettings.autoAnswer"></el-switch>
                            </el-form-item>
                            <el-form-item label="自定模板">
                                <el-input v-model="advancedSettings.choiceTemplate" type="textarea" :rows="2"
                                          placeholder="默认请留空"></el-input>
                            </el-form-item>
                            <el-form-item label="自选题目">
                                <el-input v-model="advancedSettings.choiceNumber" type="textarea" :rows="2"
                                          placeholder="默认请留空"></el-input>
                            </el-form-item>
                        </el-form>
                    </el-tab-pane>
                </el-tabs>
            </span>
            <span slot="footer" class="dialog-footer">
                <el-button @click="dialogVisible = false">取消</el-button>
                <el-button type="primary" @click="showPaper();" :disabled="networkError">开始作答</el-button>
            </span>
        </el-dialog>
    </div>
</div>
<footer id="footer">
    <div class="wrap">
        <div id="copyright">
            海之树 · 2017.03<br/>
            <i>https://GitHub.com/Haizs/NEU-mathe</i>
        </div>
    </div>
</footer>
<script src="js/vue.js"></script>
<script src="js/element-ui.js"></script>
<script src="js/axios.min.js"></script>
<script>
    var header = new Vue({
        el: '#header',
        data: {
            avatarURL: ''//'https://www.gravatar.com/avatar/?s=32'
        }
    });
    var app = new Vue({
        el: '#container',
        data: {
            radioType: '模拟练习',
            dialogTab: 'selection',
            dialogVisible: false,
            loadingChapter: false,
            networkError: false,
            types: [
                {name: '模拟练习', id: 0},
                {name: '仿真测验', id: 1}
            ],
            subjects: [
                {name: '高等数学', id: 'GS'},
                {name: '概率统计', id: 'GL'},
                {name: '复变函数', id: 'FB'},
                {name: '线性代数', id: 'XD'}
            ],
            selectedSubject: {},
            topics: [],
            defaultProps: {
                children: 'children',
                label: 'name'
            },
            advancedSettings: {
                problemCount: 0,
                examTime: 0,
                autoAnswer: false,
                choiceTemplate: '',
                choiceNumber: ''
            }
        },
        computed: {
            typeID: function () {
                return this.types.find(function (e) {
                    return e.name === app.radioType;
                }).id;
            },
            subjectID: function () {
                return this.selectedSubject.id;
            }
        },
        methods: {
            dialogInit: function () {
                this.dialogTab = 'selection';
                this.advancedSettings.problemCount = 25;
                this.advancedSettings.examTime = 90;
                this.advancedSettings.autoAnswer = false;
                this.advancedSettings.choiceTemplate = '';
                this.advancedSettings.choiceNumber = '';
            },
            loadChapter: function () {
                this.topics = [];
                this.loadingChapter = true;
                this.dialogVisible = true;
                this.networkError = false;
                this.dialogInit();
                axios.get('getChapter.php', {
                    params: {
                        subject: this.subjectID
                    }
                }).then(function (response) {
                    if (response.status !== 200) {
                        app.networkError = true;
                    }
                    app.networkError = false;
                    app.topics = response.data;
                    app.loadingChapter = false;
                }).catch(function (error) {
                    app.networkError = true;
                });
            },
            showPaper: function () {

            }
        }
    })
</script>
</body>
</html>